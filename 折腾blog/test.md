mark_content: "---\ntheme: channing-cyan\nhighlight: a11y-dark\n---\n\n 本文正在参加「Python 主题月」，详情查看 [活动链接](https://juejin.cn/post/6979532761954533390)\n\n## 前言\n\n 掘金有在看各位的很多优秀的专栏，我一直在思考，如何把这些专栏的文章内容整合在一起呢？\n\n 对，生成 PDF 文件，数据聚合，方便你我她他它。 \nDon't worry! 实现的方法方式都很简单，一共不到**200**行代码。\n\n**源码：**[JueJinColToPdf](https://github.com/xiangwenhu/JueJinColToPdf)\n\n**在线预览:**\n[我的掘金前端周栏.pdf](https://github.com/xiangwenhu/JueJinColToPdf/blob/master/pdfs/%E6%88%91%E7%9A%84%E6%8E%98%E9%87%91%E5%89%8D%E7%AB%AF%E5%91%A8%E6%A0%8F.pdf)\n\n## 效果演示\n\n### 代码执行\n\n![cmd.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8357fac2e435446385a5351a1bf97134~tplv-k3u1fbpfcp-watermark.image)\n\n### PDF 文档效果\n\n![pdf.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/013b8f30cc8d4718a8911ef1140ce32d~tplv-k3u1fbpfcp-watermark.image)\n\n## 基本思路\n\n1. 收集 API 信息和关联\n2. 下载专栏数据\n3. 生成 html 代码 (markdown 转 html)\n4. 生成 pdf 文件\n\n\n## 收集 API 信息和关联\n\n**数据是一切的根源**，所以先分析如何获取掘金专栏数据。 \n\n 其实**三个 API**就满足需求：\n\n1. [专栏摘要信息](https://api.juejin.cn/content_api/v1/column/detail) \n **作用：** 获取专栏的摘要信息，主要是**专栏 ID 和专栏名称** \n **API 地址：** https://api.juejin.cn/content_api/v1/column/detail\n \n2. [专栏文章列表](https://api.juejin.cn/content_api/v1/column/articles_cursor) \n **作用：** 获取专栏文章列表，主要是**文章 ID**，一个中间商罢了。 \n **API 地址：** https://api.juejin.cn/content_api/v1/column/articles_cursor\n3. [文章详情](https://api.juejin.cn/content_api/v1/article/detail) \n **作用：** 获取文章详情，主要是**文章标题和 MarkDown 格式的文章内容** \n **API 地址**： https://api.juejin.cn/content_api/v1/article/detail\n\n\n整体流程如下：\n\n![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc3dce5e11db48a08d1adce9f634b111~tplv-k3u1fbpfcp-watermark.image)\n\n\n### 获取专栏信息\nAPI 地址： https://api.juejin.cn/content_api/v1/column/detail?column_id=[cid]\n\n**请求参数** \nQueryString\n1. column_id 专栏 ID\n\n**数据结构** \n 有用的就是 `title`字段，生成 html 和 pdf 时需要。\n`json\n{\n column_id：\"\"6979380367216082957\" \n data: {\n \"column_version\": {\n \"title\": \"前端基础进阶“ // 专栏标题\n }\n }\n}\n`\n\n### 获取专栏文章列表\n\n**API 地址**\n`https://api.juejin.cn/content_api/v1/column/articles_cursor`\n\n**请求参数** \n `json\n {\n \"column_id\":\"6979380367216082957\", // 专栏ID\n \"cursor\":\"0\", // 当前下标\n \"limit\":20, // 一页大小\n \"sort\":0 // 0 发布事件从近到远，反之从远到近\n } \n `\n \n**数据结构**\n 有用的其实就 `artcile_id`\n`json\n{\n \"err_no\": 0,\n \"err_msg\": \"success\",\n \"cursor\": \"2\",\n \"count\": 5,\n \"has_more\": false,\n \"data\": [\n {\n \"article_id\": \"6989391487200919566\",\n .....................\n \n }\n ]\n}\n`\n\n### 获取文章详情\n\n**API 地址:** \n`https://api.juejin.cn/content_api/v1/article/detail`\n\n**请求参数:**\n`json\n{\n \"article_id\": \"6989391487200919566\" // 文章ID\n} \n`\n\n**返回结果:** \n`data`属性中的`mark_content`字段就是 markdown 语法的原始内容。\n```json\n{\n \"data\": {\n \"article_id\": \"6989391487200919566\",\n \"article_info\": {\n \"mark_content\": \"---\\ntheme: channing-cyan\\nhighlight: a11y-dark\\n---\\n\\n\\n## 前言\\n\\n 本文收录在 **[前端基础进阶](https://juejin.cn/column/6979380367216082957)** 专栏\"\n }\n },\n \"err_no\": 0,\n \"err_msg\": \"success\",\n}\n```\n\n\n\n\n## 下载专栏数据\n我们选择Python里面比较有名的`requests`库，虽然不支持异步，不过问题不大。\n\n 基本顺序：\n1. 下载专栏信息\n2. 下载专栏文章列表信息\n3. 下载单篇文章信息\n\n**注意点：**\n1. 我们会按照专栏 ID 创建文件夹，把下载下来的 JSON 格式的文件都放到下面\n \n 至于为什么？ **21 世纪什么最重要， 数据!!** \n 有了数据，你可以自己生成网页，做成 word, pdf，亦或其他，无线的选择。\n\n 本着本文为 Python 类别，还是贴一段主流程代码：\n 更多细节查看源码 **[JueJinColToPdf](https://github.com/xiangwenhu/JueJinColToPdf)\*_\n\n`python\ndef downloadColumn(cid):\n\n column = getColumn(cid);\n print(\"获取专栏信息成功，专栏名称：\", column[\"data\"][\"column_version\"][\"title\"]);\n saveColumn(cid, json.dumps(column[\"data\"]))\n\n articleList = getArticleList(cid)\n saveArticleList(cid, json.dumps(articleList[\"data\"]))\n\n articleIds = list(map(lambda item: item[\"article_id\"], articleList[\"data\"]))\n print(\"获取专栏文章列表成功：\", articleIds)\n\n for artId in articleIds:\n artContent = getArticleContent(artId)\n saveArticleContent(cid, artId, json.dumps(artContent[\"data\"]))\n print(\"文章ID为 %s 的文章下载完毕\" % artId)\n`\n\n\n## 生成 Html 代码\n\n 直接说一些问题\n\n### 如何把 markdown 格式转为 html 代码 \n 巨人的肩上`markdown`库\n `python\n html += markdown.markdown(\n removeScheme(article[\"article_info\"][\"mark_content\"]), extensions=extensions)\n ` \n\n### 如何高亮代码\n`Pygments`库，\n\n`js\npygmentize -S default -f html -a .codehilite > code.css\n`\n 然后设置一个`markdown`库的 extensions\n`python\nextensions = [ # 根据不同教程加上的扩展\n 'markdown.extensions.extra',\n 'markdown.extensions.codehilite', # 代码高亮扩展\n 'markdown.extensions.toc',\n 'markdown.extensions.tables',\n 'markdown.extensions.fenced_code',\n]\n\n html += markdown.markdown(\n removeScheme(article[\"article_info\"][\"mark_content\"]), extensions=extensions)\n`\n\n \n### 去掉掘金主题和代码风格\n 如果你选择了主题或者代码高亮，markdown 头部会多出如下的内容。\n`markdown\n---\ntheme: github\nhighlight: a11y-light\n---\n`\n 方案：正则替换或者字符串截取\n \n\n### 如何自定义样式 \n 新建一个 `extend.css`\n```css\n_ {\n font-size: 30px; // 默认字体\n}\n\nimg{\n display: block; \n min-width: 50%; // 图片至少 50%\n}\n`` \n \n### 如何生成一个大的html文件 \n 1. 创建一个html文件，\n 2. `core.css`和`extend.css文件`写入html的style标签里面\n 3. 写入头部的html， \n 4. 写入markdown转换后的html,\n 5. 最后写入尾部的html。 \n\n\n\n\n### 如果文章太多，怎么办 \n 以一定文章数量分割，比如20篇 \n 以一定文字数量分割，比如5万字\n\n在笔者的代码中是未实现的，不过问题不大，我之前有用html生成400多页的pdf也妥妥的。\n\n\n\n## 转为pdf文件\n\n借助 [wkhtmltopdf.exe](https://wkhtmltopdf.org/), 这款神奇可以把网络地址或者本地html文件直接转换成为pdf文件。 \n最重要的是其完美的支持目录。 \n\n从官方下载安装，然后配置一下环境变量就可以，代码嘛就下面这点。\n\n ``python\ndef genPdf(title):\n # TODO:: 需要配置全局路径\n exePath = \"wkhtmltopdf.exe\"\n sourcePath = \"./htmls/%s.html\" % title\n targetPath = \"./pdfs/%s.pdf\" % title\n cmd = '\"%s\" --outline-depth 2 --footer-center [page] \"%s\" \"%s\"' % (\n exePath, sourcePath, targetPath)\n print(cmd)\n subprocess.call(cmd)\n```\n\n\n\n## 写在最后\n 写作不易，你的一赞一评，就是我最大的动力。\n"
