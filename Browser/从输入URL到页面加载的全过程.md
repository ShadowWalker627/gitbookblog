# 从输入URL到页面加载的全过程

[详解https://juejin.cn/post/6844904194801926157](https://juejin.cn/post/6844904194801926157)

1. 首先在浏览器中输入URL

2. 查找缓存
查看缓存是否过期，强缓存(expire和cache-control)，如果强缓存不过期，校验协商缓存（Last-modified/if modify since和etag/if-none-match），协商缓存生效，则返回304，从服务器缓存读取资源；不生效，返回200，重新返回资源和缓存标识，存入浏览器缓存

3. DNS域名解析
依次向  浏览器DNS缓存 -> 系统hosts文件 -> 路由缓存 -> 本地配置的首选DNS服务器  发起请求，解析该URL中的域名对应的IP地址。

4. 建立TCP连接
解析出IP地址后，根据IP地址，和服务器建立TCP连接

* 1.客户端发送带有SYN标识（SYN=1，seq=x）的请求报文段，然后进入SYN_SEND状态，等待服务端确认;
* 2.服务端接收到客户端SYN报文段后，需要发送ACK信息对这个SYN进行确认，同时还要发送自己的SYN信息（SYN=1，ACK=1，seq=y，ack=x+1）服务端把这些信息放在一个报文段中（（SYN+ACK报文段），一并发给客户端，此时客户端进入SYN_RECV状态;
* 3.客户端接收到服务端的SYN+ACK报文段后会向服务端发送ACK（ACK=1，seq=x+，ack=y+1）确认报文段，这个报文段发送后，客户端和服务端都进入ESTABLISHED状态，完成三次握手。
  ![](http://192.168.2.209:3000/blogpng/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.png)
  ![](http://yoloworld.site:3000/blogpng/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.png)

5. 发起HTTP请求
TCP三次握手建立连接成功后，客户端按照指定的格式开始向服务端发送HTTP请求。

6. 服务器响应请求并返回结果
服务器对浏览器请求做出响应，并把对应的html文件发送给浏览器

7. 关闭TCP连接

通过四次挥手释放TCP连接

* 1.客户端发送连接释放标记到服务器端，然后客户端到服务器端的数据发送通道关闭，仍可以接收服务器
* 2.服务器收到连接释放释放报文，就发出确认报文，进入close-wait状态，服务器端会继续发送数据到客户端
* 3.客户端收到服务器端发送的确认报文，继续等到服务器端的连接释放报文
* 4.服务器将最后数据发送完毕，就向客户端发送连接释放报文，等待客户端确认
* 5.客户端收到释放报文，发出确认到服务器端
* 6.服务器端收到确认，进入closed状态，关闭这次tcp连接

8. 浏览器渲染和JS引擎解析

浏览器的渲染引擎基本组成：

* HTML解析器
* CSS解析器
* JS引擎

客户端（浏览器）解析HTML内容并渲染  
调用JS引擎执行JS代码（JS的解释阶段，预处理阶段，执行阶段生成执行上下文，VO，作用域链、回收机制等等）
